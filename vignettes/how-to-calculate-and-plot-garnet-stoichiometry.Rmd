---
title: "how-to-calculate-and-plot-garnet-stoicheometry"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{how-to-calculate-and-plot-garnet-stoicheometry}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

#1. Libraries import

- install package devtools to download both ztR (for garnet steichieometry) and ggarnet to plot the garnet end-members in ternary diagram from github directly.
```{r setup}

devtools::install_github("gabertol/ztR")
devtools::install_github("gabertol/ggarnet")

library(tidyverse)
library(ztR)
library(ggarnet)


```

#2. Importing
- Import a table from .csv or excel with garnet mineral chemistry data, or use the benchmark dataframe provided by benchmark_garnet1() function
```{r}
# Use dataset provided
Gnt_1<-garnet_benchmark_01()

# Or import your dataset
library(readxl) # Import package readxl to import direct from excel

#your_data<-read.csv("file-location.csv")
#your_data<-readxl::readexcel("file-location.xlsx")

```

#3. Stoichiometry calculation
- 
```{r}
# Garnet atomic weights
garnet_EW()

#Atom units calculation
garnet_atom_units(Gnt_1)

#Site occupancy calculation
garnet_atom_units(Gnt_1) %>% 
  garnet_site_occupancy(.)

# Fe2+Fe3 in uvarovite,andradite,Ca-Ti garnet
garnet_atom_units(Gnt_1) %>%  # convert the weight% chemistry data to atomic units
        garnet_site_occupancy(.) %>%  # define site occupancy per element
        garnet_endmember_fe3(.)  # calculate garnet end-member based on Fe3 content resulting uvarovite,andradite,Ca-Ti garnet 

#  Fe2+Fe3 in grossularia, pyrope, almandine, and spessartine
garnet_atom_units(Gnt_1) %>%  # convert the weight% chemistry data to atomic units
        garnet_site_occupancy(.) %>%  # define site occupancy per element
        garnet_endmember_fe2(.)  # calculate garnet endmembers proportion using the Fe3 and Fe2 for grossularia, pyrope, almandine, and spessartine- without the presence of spessartine, uvarovite, andradite and Ca-Ti garnets

#  Fe2+Fe3 in grossularia, pyrope, almandine, and spessartine
garnet_atom_units(Gnt_1) %>%  # convert the weight% chemistry data to atomic units
        garnet_site_occupancy(.) %>%  # define site occupancy per element
        garnet_endmember_fe(.)  # calculate garnet endmembers proportion using the Fe3 and Fe2 for grossularia, pyrope, almandine, and spessartine - without the presence of spessartine, uvarovite, andradite and Ca-Ti garnets

# Calculating all in a single dataframe

BCH_01<-garnet_atom_units(Gnt_1) %>% 
        garnet_site_occupancy(.) %>% 
        cbind(.,garnet_endmember_fe3(.)) %>% 
        cbind(.,garnet_endmember_fe(.)) %>% 
        cbind(.,garnet_endmember_fe2(.)) 

```

#4. Plot in garnet classification ternary diagram

```{r}
ggarnet_fe_mn()+
geom_point(data=BCH_01,aes(x=Fe2+Fe3+Mn,y=Ca,z=Mg))

ggarnet_mn()+
geom_point(data=BCH_01,aes(x=Mn,y=Ca,z=Mg))
```

# DHZ calculation
```{r}

# Tourmaline
read.csv("./data/tourmaline_DHZ.csv") %>%   
    chemical_formula(.,31,16)->tur

# Garnet
 read.csv("./data/garnet_DHZ.csv") %>% 
    chemical_formula(.,24,16) -> GT
  
# Epidote 
 read.csv("./data/epidote_DHZ.csv") %>% 
    chemical_formula(.,c(12.5,13,12.5,12.5,12.5,13),8)  # vector with different qtty of oxigens
  


```


#4. Plot in garnet classification ternary diagram

```{r}
ggarnet_fe_mn()+
geom_point(data=GT,aes(x=Fe3+Fe+Mn,z=Ca,y=Mg,shape=mineral),size=4.5,alpha=0.5)

ggarnet_mn()+
geom_point(data=GT,aes(x=Fe3+Fe+Mn,y=Ca,z=Mg))

ggarnet_tourmaline()+
  geom_point(data=tur,aes(x=Fe3+Fe,y=Al,z=Mg,shape=mineral),size=4.5,alpha=0.5)
  

```

# Crystallographic sites
```{r}
sites_epi<-tribble(~element,~prim_site,~sec_site,~total_site1,~total_site2,
                   "Si",1,1,3,3,
                   "Ti",2,2,3,3,
                   "Al",2,1,3,3, 
                   "Fe3",2,2,3,3, 
                   "Mn3",2,2,3,3,
                   "Y",3,3,2,2,  
                   "Ce",3,3,2,2, 
                   "La",3,3,2,2,  
                   "Fe",3,3,2,2,   
                   "Mn",3,3,2,2,  
                   "Mg",3,3,2,2,  
                   "Ca",3,3,2,2,  
                   "Na",3,3,2,2,   
                   "K",3,3,2,2,   
                   "OH",4,4,1,1)

sites_gar<-tribble(~element,~prim_site,~sec_site,~total_site1,~total_site2,~order_s1,~order_s2,
        "Si",1,1,6,6,1,1, 
        "Ti",2,2,4,4,NA,NA,
        "Al",2,1,4,6,1,2,  
        "Cr",2,2,4,4,NA,NA,  
        "Fe3",2,2,4,4,NA,NA,
        "Fe",3,3,6,6,NA,NA,  
        "Mn",3,3,6,6,NA,NA, 
        "Mg",3,3,6,6,NA,NA, 
        "Ca",3,3,6,6,NA,NA) 



sites_tur<-tribble(~element,~prim_site,~sec_site,~total_site1,~total_site2,~order_s1,~order_s2,
   "Si","T","T",6,6,1,1,
   "B","Z","T",6,6,1,3,
   "Al","Z","T",6,6,2,2,
   "Ti","Y","Y",3,3,NA,NA,
   "Fe","Y","Y",3,3,NA,NA,
   "Fe3","Z","Y",6,3,4,NA,
   "Mg","Z","Y",6,3,2,2,
   "Mn","Y","Y",3,3,NA,NA,
   "Zn","Y","Y",3,3,NA,NA,
   "Li","Y","Y",3,3,NA,NA,
   "K","X","X",1,1,NA,NA,
   "Ca","X","X",1,1,NA,NA,
   "Sr","X","X",1,1,NA,NA,
   "Na","X","X",1,1,NA,NA, 
   "F","W","W",4,4,2,2,   
   "OH","W","W",4,4,1,1,   
  
)
```

# End-member
```{r}
garnet
```

